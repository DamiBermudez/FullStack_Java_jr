<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Registrar Hospitales</title>
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>
        <header>
            <div id="logo">
                <div><img src="/css/icono.svg" alt="Logotipo de un electrocardiograma" height="40px" width="40px"></div>
                <div><p>Sistema de Gestión de Hospitales</p></div>               
                
            </div>

        </header>
        <main>
            <div>
                <h1>Registrar Hospitales</h1>
            </div>
            <div>
                <form id="formInsertar">
                    <label for="hospital">Nombre del Hospital:</label>
                    <input type="text" id="hospital" name="nom_hospital" required><br>

                    <label for="gerente">Gerente:</label>
                    <select id="gerente" name="id_gerente" required></select><br>

                    <label for="condicion">Condición:</label>
                    <select id="condicion" name="id_condicion" required></select><br>

                    <label for="sede">Sede:</label>
                    <select id="sede" name="id_sede" required></select><br>

                    <label for="distrito">Distrito:</label>
                    <select id="distrito" name="id_distrito" required></select><br>

                    <button type="submit">Registrar</button>
                </form>

            </div>

        </main>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                cargarSelect("/api/gerentes", "gerente", "id_gerente", "nom_gerente");
                cargarSelect("/api/condiciones", "condicion", "id_condicion", "nom_condicion");
                cargarSelect("/api/sedes", "sede", "id_sede", "nom_sede");
                cargarSelect("/api/distritos", "distrito", "id_distrito", "nom_distrito");

                function cargarSelect(api, selectId, idField, textField) {
                    fetch(api)
                        .then(res => res.json())
                        .then(data => {
                            const select = document.getElementById(selectId);
                            select.innerHTML = '<option value="">Seleccione</option>';
                            data.forEach(item => {
                                const opt = document.createElement("option");
                                opt.value = item[idField];
                                opt.textContent = item[textField];
                                select.appendChild(opt);
                            });
                        })
                        .catch(error => console.error("Error cargando " + api, error));
                }

                document.getElementById("formInsertar").addEventListener("submit", e => {
                    e.preventDefault();

                    const formData = new FormData();
                    formData.append("hospital", document.getElementById("hospital").value);
                    formData.append("idGerente", document.getElementById("gerente").value);
                    formData.append("idCondicion", document.getElementById("condicion").value);
                    formData.append("idSede", document.getElementById("sede").value);
                    formData.append("idDistrito", document.getElementById("distrito").value);

                    fetch("http://localhost:8080/api/hospitales/registrar", {
                        method: "POST",
                        body: formData,
                    })
                    .then(res => {
                        if (res.ok) {
                            alert("Hospital registrado con éxito.");
                            document.getElementById("formInsertar").reset();
                        } else {
                            alert("Error al registrar hospital.");
                        }
                    })
                    .catch(err => {
                        console.error("Error del servidor:", err);
                        alert("Error del servidor.");
                    });
                });
            });
        </script>





    </body>
</html>