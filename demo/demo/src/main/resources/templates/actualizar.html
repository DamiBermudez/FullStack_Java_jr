<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Actualizar Hospitales</title>
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>
        <header>
            <div id="logo">
                <div><img src="/css/icono.svg" alt="Logotipo de un electrocardiograma" height="40px" width="40px"></div>
                <div><p>Sistema de Gestión de Hospitales</p></div>
                <nav>
                    <div><a href="home">Home</a>
                        <a href="registrar">Nuevo</a>
                        <a href="listar">Listar</a>
                        <a href="eliminar">Eliminar</a></div>

                </nav>
            </div>


        </header>
        <main>
            <div>
                <h1>Actualizar Hospitales</h1>
            </div>
            <h2>Buscar Hospital</h2>
            <input type="number" id="buscarId" placeholder="ID del hospital">
            <button onclick="buscarHospital()">Buscar</button>

            <hr>

            <form id="formActualizar" style="display: none;">
                <input type="hidden" id="id_hospital" />

                <label for="hospital">Nombre:</label>
                <input type="text" id="hospital" required><br>

                <label for="condicion">Condición:</label>
                <input type="text" id="condicion" required><br>

                <label for="gerente">Gerente:</label>
                <input type="text" id="gerente" required><br>

                <label for="sede">Sede:</label>
                <input type="text" id="sede" required><br>

                <label for="distrito">Distrito:</label>
                <input type="text" id="distrito" required><br>

                <button type="submit">Actualizar</button>
            </form>


        </main>


        <script>
            async function buscarHospital() {
              const id = document.getElementById("buscarId").value;

              if (!id) {
                alert("Ingresa un ID");
                return;
              }

              try {
                const response = await fetch(`http://localhost:8080/api/hospitales/${id}`);
                if (!response.ok) {
                  alert("Hospital no encontrado");
                  return;
                }

                const data = await response.json();

                // Rellenar los campos del formulario
                document.getElementById("formActualizar").style.display = "block";
                document.getElementById("id_hospital").value = data.id_hospital;
                document.getElementById("hospital").value = data.hospital;
                document.getElementById("condicion").value = data.condicion;
                document.getElementById("gerente").value = data.gerente;
                document.getElementById("sede").value = data.sede;
                document.getElementById("distrito").value = data.distrito;

              } catch (error) {
                console.error("Error:", error);
                alert("Error al buscar hospital");
              }
            }

            document.getElementById("formActualizar").addEventListener("submit", async function(e) {
              e.preventDefault();

              const hospital = {
                id_hospital: document.getElementById("buscarId").value,
                hospital: document.getElementById("hospital").value,
                condicion: document.getElementById("condicion").value,
                gerente: document.getElementById("gerente").value,
                sede: document.getElementById("sede").value,
                distrito: document.getElementById("distrito").value
              };

              try {
                const id = document.getElementById("buscarId").value;
                const response = await fetch(`http://localhost:8080/api/hospitales/${id}`, {
                  method: "PUT",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(hospital)
                });

                if (response.ok) {
                  alert("Hospital actualizado correctamente");
                  document.getElementById("formActualizar").reset();
                  document.getElementById("formActualizar").style.display = "none";
                } else {
                  const errorText = await res.text();
                  alert("Error al actualizar: " + errorText);
                }
              } catch (error) {
                console.error("Error:", error);
                alert("Error en la conexión");
              }
            });
        </script>

    </body>
</html>